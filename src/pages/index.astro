---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import ProjectsSection from '../components/ProjectsSection.astro';
import SkillsSection from '../components/SkillsSection.astro';
import CallToAction from '../components/CallToAction.astro';
import { getProjects, getSkills, getProfile } from '../lib/db';

const db = Astro.locals.runtime?.env?.DB;

let projects = [];
let skills = [];
let profile = null;

if (db) {
  projects = (await getProjects(db)).slice(0, 3);
  skills = (await getSkills(db)).slice(0, 8);
  profile = await getProfile(db);
}
---

<Layout 
    title="Home" 
    description={profile?.about?.[0] || "I help companies build modern, scalable, and secure web applications."}
>
    <Hero />
    <ProjectsSection projects={projects} />
    <SkillsSection skills={skills} />
    <CallToAction />
</Layout>
